handleLanguage();let cash=[],isNoWeakSelected=handleNoBombsAdviseChange();addInputsListeners();let mainField=[[],[],[],[],[]];mainField.forEach((e=>{for(;5!==e.length;)e.push({value:0,state:"empty",recomended:0})})),cashField(mainField);let step=-2,strongs=0;const container=document.getElementById("container");function render(e,t,n){mainField!==e&&(mainField=deepCopy(e));const o=[];t&&t.forEach((e=>{o.push(e.moves[0])})),mainField.forEach(((e,t)=>{e.forEach(((e,a)=>{const s=`${t}${a}`,r=document.getElementById(s);n||(e.recomended=o.length>0?o.findIndex((e=>e===s))+1:0),r.className=`square ${e.state} ${getClassByRec(e.recomended)}`}))}))}function incrementStrongs(){strongs++}function findFullLines(e,t,n){let o=!1;for(let a=0;a<5;a++)if(e[a][0].value){5===e[a].reduce(((e,t)=>e+t.value),0)&&e[a].forEach(((e,s)=>{"strong"!==e.state&&(n&&(e.state="strong"),t()),1===a&&1===s&&(o=!0)}))}for(let a=0;a<5;a++)if(e[0][a].value){let s=0;for(;s<5&&e[s][a].value;s++);if(5===s)for(let s=0;s<5;s++)"strong"!==e[s][a].state&&(n&&(e[s][a].state="strong"),1===s&&1===a&&(o=!0),t())}return o}function getClassByRec(e){switch(e){case 3:return"low-req";case 2:return"mid-req";case 1:return"top-req";default:return""}}function changeNearSquares(e,t,n){changeSquareProps(e,t,n),e-1>=0&&changeSquareProps(e-1,t,n),e+1<=4&&changeSquareProps(e+1,t,n),t-1>=0&&changeSquareProps(e,t-1,n),t+1<=4&&changeSquareProps(e,t+1,n)}function changeSquareProps(e,t,n){const o=n[e][t];0===o.value?(o.value=1,o.state="weak"):1===o.value&&"weak"===o.state&&(o.value=0,o.state="empty")}function defineRecomendations(e){if(step%3==0){const a=t(e),s=[],r=[];return a.forEach((e=>{!function(e,t,n){const a=e?e.bombs:null,s=e?e.moves:null,r=e?e.field:t;for(let e=0;e<5;e++)for(let t=0;t<5;t++){if("strong"===r[e][t].state)continue;if(isNoWeakSelected&&"weak"===r[e][t].state)continue;const i=o(e,t,r,strongs,a,s);!i||i.isBlow||i.isClown||n.push(i)}n.sort(comparator)}(e,null,s)})),s.forEach((e=>{n(e,null,r)})),r.sort(comparator),getDifferentVariants(r)}if(step%3==1){const o=t(e),a=[];return o.forEach((e=>{n(e,null,a)})),a.sort(comparator),getDifferentVariants(a)}if(step%3==2){const t=[];return n(null,e,t),t.sort(comparator),getDifferentVariants(t)}function t(e){let t=[];for(let n=0;n<e.length;n++)for(let a=0;a<e[n].length;a++){if("strong"===e[n][a].state)continue;if(isNoWeakSelected&&"weak"===e[n][a].state)continue;const s=o(n,a,e,strongs);!s||s.isBlow||s.isClown||t.push(s)}return t.sort(comparator)}function n(e,t,n){const a=e?e.bombs:null,s=e?e.moves:null,r=e?e.field:t;for(let e=0;e<5;e++)for(let t=0;t<5;t++){if("strong"===r[e][t].state)continue;const i=o(e,t,r,strongs,a,s);i&&i.isBlow&&!i.isClown&&n.push(i)}}function o(e,t,n,o,a,s){const r={bombs:a||0,field:deepCopy(n),moves:s?[...s]:[],isBlow:!1,continuity:0,isClown:!1};let i=o;return r.moves.push(`${e}${t}`),addBombsOnField(e,t,r),e-1>=0&&addBombsOnField(e-1,t,r),e+1<=4&&addBombsOnField(e+1,t,r),t-1>=0&&addBombsOnField(e,t-1,r),t+1<=4&&addBombsOnField(e,t+1,r),r.isClown=findFullLines(r.field,(()=>{i++}),!1),r.continuity=findMaxContinuity(getMatrix(r.field)),i!==o&&(r.isBlow=!0),r}}function addBombsOnField(e,t,n){"empty"===n.field[e][t].state?(n.bombs+=1,n.field[e][t].state="weak",n.field[e][t].value=1):"weak"===n.field[e][t].state&&(n.bombs-=1,n.field[e][t].state="empty",n.field[e][t].value=0)}function cashField(e){cash.push(deepCopy(e))}function cashStepBack(){cash.pop()}function deepCopy(e){return JSON.parse(JSON.stringify(e))}function getMatrix(e){const t=[];return e.forEach(((e,n)=>{t[n]=e.map((e=>e.state))})),t}function findMaxContinuity(e){let t=e.length,n=e[0].length;const o=[];function a(e,t,n,s){e[t][n]="marked",o[s]?o[s]+=1:o[s]=1,"empty"===e[t][n-1]&&a(e,t,n-1,s),"empty"===e[t][n+1]&&a(e,t,n+1,s),"empty"===e?.[t-1]?.[n]&&a(e,t-1,n,s),"empty"===e?.[t+1]?.[n]&&a(e,t+1,n,s)}for(let s=0;s<t;s++)for(let t=0;t<n;t++)"empty"===e[s][t]&&a(e,s,t,o.length);return getMaxOfArray(o)}function getMaxOfArray(e){return Math.max.apply(null,e)}function comparator(e,t){return e.continuity>t.continuity?-1:e.continuity<t.continuity||e.bombs>t.bombs?1:e.bombs<t.bombs?-1:void 0}function addInputsListeners(){document.getElementById("cancel").addEventListener("click",(()=>{cash.length>1&&(cash.pop(),step--,render(cash[cash.length-1],null,!0))})),document.getElementById("clear").addEventListener("click",(()=>{cash=[cash[0]],step=-2,strongs=getCurrentStrongsCount(cash[0]),render(cash[0],null,!0)})),document.getElementById("switch-1").addEventListener("change",(e=>{isNoWeakSelected=e.target.checked,localStorage.setItem("kykyNoBombsOnWeak",`${isNoWeakSelected}`)}))}function handleNoBombsAdviseChange(){const e=document.getElementById("switch-1"),t=localStorage.getItem("kykyNoBombsOnWeak");return"true"===t?e.checked=!0:"false"===t&&(e.checked=!1),e.checked}function getCurrentStrongsCount(e){let t=0;return e.forEach((e=>{e.forEach((e=>{"strong"===e.state&&t++}))})),t}function handleLanguage(){let e=localStorage.getItem("kukuLanguage");const t=document.getElementById("switch-2");"En"===e?t.checked=!0:(e="Ru",t.checked=!1),applyLanguage(e);t.addEventListener("change",(t=>{e=t.target.checked?"En":"Ru",localStorage.setItem("kukuLanguage",e),applyLanguage(e)}))}function applyLanguage(e){Object.entries({cancel:["Отменить ход","Undo move"],clear:["Очистить поле","Clear field"],"bombs-switcher":["Не советовать ставить бомбы на черепа","Do not advise putting bombs on skulls"],tip:["Используйте Иону! (Ctrl + C)","Use Inanna! (Ctrl + C)"]}).forEach((([t,n])=>{document.getElementById(t).innerHTML=n["Ru"===e?0:1]}))}function getDifferentVariants(e){const t=[],n=[];for(let o=0;o<e.length&&t.length<3;o++)t.includes(e[o].moves[0])||(n.push(e[o]),t.push(e[o].moves[0]));return n}function makeAlert(){const e=document.getElementById("tip");e.className="show",setTimeout((()=>{e.classList.toggle("show")}),8e3)}mainField.forEach(((e,t)=>{e.forEach(((e,n)=>{const o=document.createElement("div");o.className="square",o.id=`${t}${n}`,o.addEventListener("click",(()=>{const e=strongs,a=mainField[t][n];if(step<0?(a.value=1,a.state="weak",o.classList.add(a.state)):(changeNearSquares(t,n,mainField),findFullLines(mainField,incrementStrongs,!0)),step++,step%3==0&&0!==step&&e===strongs&&makeAlert(),step>=0){const e=defineRecomendations(mainField);render(mainField,e,!1)}cashField(mainField)})),container.append(o)}))}));
//# sourceMappingURL=index.4d713f38.js.map
